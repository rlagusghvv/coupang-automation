<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Couplus</title>
    <link rel="stylesheet" href="/styles.css" />

    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
  </head>
  <body>
    <main class="wrap">
      <header class="topbar">
        <div class="brand">
          <div class="logo">Couplus</div>
          <div class="tagline">도매꾹/도매매 → 쿠팡 자동화 대시보드</div>
        </div>
        <div class="topbar-right">
          <div class="topbar-actions">
            <button id="themeToggle" class="icon-btn" type="button" title="테마 전환 (자동/라이트/다크)">테마</button>
          </div>
          <div class="session-badges">
            <span class="badge" id="badgeDomeggook">도매꾹: -</span>
            <span class="badge" id="badgeDomeme">도매매: -</span>
          </div>
          <div class="version" id="versionInfo">버전 확인 중...</div>
        </div>
      </header>

      <div class="toss-app">
        <section class="view" id="view-home">
          <div class="home-dashboard">
            <!-- Session card -->
            <section class="dash-card" aria-label="세션">
              <div class="dash-head">
                <h2 class="dash-title">세션</h2>
                <div class="dash-chips">
                  <span class="chip" id="homeChipDomeggook">도매꾹: -</span>
                  <span class="chip" id="homeChipDomeme">도매매: -</span>
                </div>
              </div>
              <div class="dash-body">
                <div class="dash-grid">
                  <div class="dash-item">
                    <div class="dash-label">도매꾹</div>
                    <div class="dash-value" id="homeDomeggookSessionText">-</div>
                    <div class="btn-row">
                      <button id="homeCreateDomeggookSession" type="button">로그인(브라우저 열기)</button>
                      <button id="homeSaveDomeggookSession" type="button" class="ghost">지금 저장</button>
                    </div>
                  </div>
                  <div class="dash-item">
                    <div class="dash-label">도매매</div>
                    <div class="dash-value" id="homeDomemeSessionText">-</div>
                    <div class="btn-row">
                      <button id="homeCreateDomemeSession" type="button">로그인(브라우저 열기)</button>
                      <button id="homeSaveDomemeSession" type="button" class="ghost">지금 저장</button>
                    </div>
                  </div>
                </div>
                <p class="hint">로그인 완료 후 ‘지금 저장’을 누르면 세션이 저장됩니다.</p>
              </div>
            </section>

            <!-- Upload card -->
            <section class="dash-card" aria-label="업로드">
              <div class="dash-head">
                <h2 class="dash-title">상품 업로드</h2>
                <div class="dash-sub" id="homeUploadGate">-</div>
              </div>
              <div class="dash-body">
                <label class="sr-only" for="url">도매꾹/도매매 상품 링크</label>
                <input id="url" type="url" placeholder="https://domeggook.com/..." inputmode="url" />
                <div class="btn-row">
                  <button id="previewUpload" type="button" class="ghost">미리보기</button>
                  <button id="submit" type="button">실행</button>
                </div>
                <div class="mini-card hidden" id="uploadPreviewCard">
                  <div class="mini-title">미리보기</div>
                  <div class="mini-kv" id="uploadPreviewKv"></div>
                </div>
                <p class="hint">미리보기로 제목/가격/옵션/이미지를 확인한 뒤 실행하세요.</p>
              </div>
            </section>

            <!-- Purchase/Payment card -->
            <section class="dash-card" aria-label="발주/결제">
              <div class="dash-head">
                <h2 class="dash-title">발주/결제</h2>
                <div class="dash-sub">최근 결제 링크</div>
              </div>
              <div class="dash-body">
                <div class="btn-row">
                  <button id="homeDraftPurchase" type="button">발주 엑셀 생성</button>
                  <button id="homeUploadPurchase" type="button">발주 업로드</button>
                </div>
                <div class="mini-card" id="homePayButtons"></div>
                <p class="hint">발주 업로드 후 ‘결제하러 가기’ 버튼이 활성화됩니다.</p>
              </div>
            </section>

            <!-- Recent activity card -->
            <section class="dash-card" aria-label="최근 활동">
              <div class="dash-head">
                <h2 class="dash-title">최근 활동</h2>
                <button id="homeRefreshActivity" type="button" class="ghost">새로고침</button>
              </div>
              <div class="dash-body">
                <div class="activity-list" id="homeActivityList"></div>
              </div>
            </section>
          </div>
        </section>

        <section class="view hidden" id="view-activity">
          <div class="settings-page">
            <section class="settings-section card">
              <h2 class="section-title">주문/발주</h2>
              <div class="panel order-actions" id="panel-orders">
            <label>쿠팡 주문 → 도매처 발주</label>

          <div class="row compact-row hidden" id="devOrdersRow">
            <button id="seedOrders">(개발용) 더미 주문 2개 생성</button>
            <button id="refreshOrders">주문 목록 새로고침</button>
          </div>
          <div class="grid hidden" id="ordersListWrap">
            <div>
              <label>주문 목록 (MVP)</label>
              <textarea id="ordersList" rows="6" readonly></textarea>
            </div>
          </div>

          <div class="divider"></div>

          <label>시드 주문 → 발주 업로드 (MVP)</label>
          <div class="row compact-row">
            <button id="draftPurchase">발주 엑셀 생성</button>
            <button id="uploadPurchase">발주 업로드</button>
          </div>
          <div class="row compact-row">
            <span class="hint">마지막 발주 엑셀: <span id="lastPurchaseDraft">-</span></span>
          </div>
          <div class="grid">
            <div>
              <label>발주 로그</label>
              <textarea id="purchaseLog" rows="6" readonly></textarea>
              <div class="row compact-row" id="purchasePayActions"></div>
            </div>
          </div>

          <div class="divider"></div>

          <label>쿠팡 주문 → 도매매 엑셀 생성</label>
          <div class="grid">
            <div>
              <label>시작일 (YYYY-MM-DD)</label>
              <input id="orderFrom" type="date" />
            </div>
            <div>
              <label>종료일 (YYYY-MM-DD)</label>
              <input id="orderTo" type="date" />
            </div>
          </div>
          <div class="row compact-row">
            <button id="exportOrders">엑셀 생성</button>
          </div>
          <div class="row compact-row">
            <button id="uploadOrders">도매매 업로드</button>
          </div>
          <div class="row compact-row">
            <span class="hint">마지막 생성 엑셀: <span id="lastExportPath">-</span></span>
          </div>
          <div class="divider"></div>
          <div class="sku-map-section">
            <label>SKU 매핑</label>
          <div class="row compact-row">
            <button id="loadMissing">누락 목록 불러오기</button>
            <button id="loadSkuMap">매핑 불러오기</button>
            <button id="saveSkuMap">매핑 저장</button>
          </div>
          <div class="grid">
            <div>
              <label>누락 목록 (읽기전용)</label>
              <textarea id="missingSku" rows="6" readonly></textarea>
            </div>
            <div>
              <label>SKU 매핑 JSON</label>
              <textarea id="skuMap" rows="6" placeholder='{\"vendorItemId\": {\"itemNo\":\"47185732\",\"optionCode\":\"00_01\",\"optionName\":\"...\"}}'></textarea>
            </div>
          </div>
          </div>
          <p class="hint">상태: 결제완료(ACCEPT)만 포함됩니다.</p>
        </div>

          </div>
            </section>

            <section class="settings-section card">
              <h2 class="section-title">히스토리</h2>
              <div class="panel" id="panel-history">
          <div class="row compact-row">
            <button id="refreshHistory">히스토리 새로고침</button>
          </div>
          <div class="history-table" id="historyTable"></div>
        </div>

          </div>
            </section>
          </div>
        </section>

        <section class="view hidden" id="view-settings">
          <div class="settings-page">
            <section class="settings-section card">
              <h2 class="section-title">설정</h2>
              <div class="panel" id="panel-settings">
          <div class="grid">
            <div>
              <label>쿠팡 Access Key</label>
              <input id="ckey" type="text" placeholder="access key" />
            </div>
            <div>
              <label>쿠팡 Secret Key</label>
              <input id="skey" type="password" placeholder="secret key" />
            </div>
            <div>
              <label>Vendor ID</label>
              <input id="vendorId" type="text" placeholder="A0..." />
            </div>
            <div>
              <label>Vendor User ID</label>
              <input id="vendorUserId" type="text" placeholder="..." />
            </div>
            <div>
              <label>배송사 코드</label>
              <input id="deliveryCode" type="text" placeholder="CJGLS" />
            </div>
            <div>
              <label>이미지 프록시</label>
              <input id="proxyBase" type="text" placeholder="https://coupang-automation.pages.dev" />
            </div>
            <div>
              <label>허용 IP 목록 (쉼표로 구분)</label>
              <input id="allowedIps" type="text" placeholder="104.28.211.26, 104.28.243.28" />
            </div>
            <div>
              <label>도매꾹 세션 파일 경로</label>
              <input id="domeggookStorageStatePath" type="text" placeholder="/Users/.../storageState.domeggook.json" />
            </div>
            <div>
              <label>도매꾹 세션 만들기</label>
              <div class="row compact-row">
                <button id="createDomeggookSession">브라우저 열기</button>
                <button id="saveDomeggookSession" class="ghost">지금 저장</button>
                <span class="hint">로그인 완료되면 ‘지금 저장’</span>
              </div>
              <p class="hint">세션 상태: <span id="domeggookSessionStatus">-</span></p>
            </div>
            <div>
              <label>도매매 ID</label>
              <input id="domemeId" type="text" placeholder="domeme id" />
            </div>
            <div>
              <label>도매매 PW</label>
              <input id="domemePw" type="password" placeholder="domeme password" />
            </div>
            <div>
              <label>도매매 세션 파일 경로</label>
              <input id="domemeStorageStatePath" type="text" placeholder="/Users/.../storageState.domeme.json" />
            </div>
            <div>
              <label>도매매 세션 만들기</label>
              <div class="row compact-row">
                <button id="createDomemeSession">브라우저 열기</button>
                <button id="saveDomemeSession" class="ghost">지금 저장</button>
                <span class="hint">로그인 완료되면 ‘지금 저장’</span>
              </div>
              <p class="hint">세션 상태: <span id="domemeSessionStatus">-</span></p>
            </div>
            <div>
              <label>Pages 프로젝트명</label>
              <input id="pagesProjectName" type="text" placeholder="coupang-automation" />
            </div>
            <div>
              <label>Pages Account ID</label>
              <input id="pagesAccountId" type="text" placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" />
            </div>
            <div>
              <label>Pages API Token</label>
              <input id="pagesApiToken" type="password" placeholder="cf api token" />
            </div>
            <div>
              <label>Pages 자동 배포</label>
              <input id="pagesAutoDeploy" type="checkbox" />
            </div>
          </div>

          <div class="grid">
            <div>
              <label>마진률 (예: 0.3)</label>
              <input id="marginRate" type="number" step="0.01" />
            </div>
            <div>
              <label>추가금 (원)</label>
              <input id="marginAdd" type="number" step="10" />
            </div>
            <div>
              <label>최소가격</label>
              <input id="priceMin" type="number" step="10" />
            </div>
            <div>
              <label>라운딩 단위</label>
              <input id="roundUnit" type="number" step="1" />
            </div>
          </div>
          <p class="hint">가격 공식: 도매꾹가 × (1+마진률) + 추가금 → 라운딩</p>

          <div class="settings-actions">
            <label class="toggle">
              <input id="autoRequest" type="checkbox" />
              <span>자동 승인요청 (임시저장 없이 요청)</span>
            </label>
            <label class="toggle">
              <input id="payloadOnly" type="checkbox" />
              <span>쿠팡 API 호출 안함 (payload만 생성)</span>
            </label>
            <label class="toggle">
              <input id="soundOnComplete" type="checkbox" />
              <span>완료 알림 소리</span>
            </label>
            <button id="saveSettings">설정 저장</button>
          </div>
          <div class="mini-row">
            <span class="hint">현재 공인 IP: <span id="currentIp">-</span></span>
            <button id="refreshIp" class="mini-btn">IP 새로고침</button>
          </div>
        </div>

          </div>
            </section>

            <section class="settings-section card">
              <h2 class="section-title">계정</h2>
              <div class="panel" id="panel-account">
          <div class="grid">
            <div>
              <label>이메일</label>
              <input id="email" type="email" />
            </div>
            <div>
              <label>비밀번호</label>
              <input id="password" type="password" />
            </div>
          </div>
          <div class="row">
            <button id="signup">회원가입</button>
            <button id="login">로그인</button>
            <button id="logout">로그아웃</button>
          </div>
          <p class="hint" id="authStatus">로그인 필요</p>
        </div>
            </section>
          </div>
        </section>

        <nav class="bottombar" aria-label="primary">
          <button class="nav-item active" type="button" data-view="home">홈</button>
          <button class="nav-item" type="button" data-view="activity">작업</button>
          <button class="nav-item" type="button" data-view="settings">설정</button>
        </nav>
      </div>

      <section class="card">
        <div class="status">
          <div class="dot" id="dot"></div>
          <span id="status">대기 중</span>
        </div>
        <div id="summary" class="summary hidden"></div>
        <details class="raw">
          <summary>상세 로그 보기</summary>
          <pre id="log" class="log"></pre>
        </details>
      </section>
    </main>

    <script src="/app.js"></script>
  </body>
</html>
